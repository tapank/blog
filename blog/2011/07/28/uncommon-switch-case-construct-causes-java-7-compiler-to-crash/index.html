<!DOCTYPE html>
<html lang="en-us">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<style type=text/css>body{font-family:monospace;}</style>
	<title>Uncommon switch-case construct causes java 7 compiler to crash</title>
	
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B15DFJNCEQ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-B15DFJNCEQ', { 'anonymize_ip': false });
}
</script>

	
	<meta name="author" content="Tapan Karecha">
	<link rel="stylesheet" href="/css/style.css">
	
</head>
<body>
	<header>
	== <b>Notes to self</b> ==<br>
	<i>Not gold alone brought us hither</i>
	<p>
	<nav>
			
			
			<a href="/"><b>Home</b></a>.
			
			<a href="/index.xml"><b>RSS Feed</b></a>.
			
	</nav>
	
</header>

	
	<main>
		<article>
			<h1>Uncommon switch-case construct causes java 7 compiler to crash</h1>
			<b><time>28 Jul 2011</time></b>
		       

			<div>
				<p><a href="http://java.sun.com/docs/books/jls/download/langspec-3.0.pdf">Java language specification 3.0</a> defines a switch block as:</p>
<blockquote>
<p>The body of a switch statement is known as a switch block. Any statement immediately contained by the switch block may be labeled with one or more case or default labels. These labels are said to be associated with the switch statement, as are the values of the constant expressions in the case labels.</p>
</blockquote>
<p>One of the valid forms of constant expression is: Parenthesized expressions whose contained expression is a constant expression, and examples are:</p>
<p><code>case (3):</code></p>
<p>or</p>
<p><code>case (1 + 2):</code></p>
<p>Java 7 introduces support for strings in switch (part of <a href="http://openjdk.java.net/projects/coin/">project coin</a>). Using the form of constant expression listed above, with strings in switch, causes javac to crash with a NullPointerException. This is a bug in java 7 compiler and I have reported this in Java bug database.</p>
<p>Hereâ€™s a test program to reproduce the issue:</p>
<pre tabindex="0"><code>public class Test {
    public static void main(String args[]) {
        switch(args[0]) {
            case(&#34;hello&#34;): // causes javac to crash
                System.out.println(&#34;hello!!&#34;);
                break;
            default:
                System.out.println(&#34;hi!&#34;);
        }
    }
}
</code></pre><p>Running javac Test.java results in:</p>
<pre tabindex="0"><code>An exception has occurred in the compiler (1.7.0).
Please file a bug at the Java Developer Connection
(http://java.sun.com/webapps/bugreport)  after checking
the Bug Parade for duplicates. Include your program
and the following diagnostic in your report.  Thank you.
java.lang.NullPointerException
        at com.sun.tools.javac.comp.Lower.visitStringSwitch(Lower.java:3456)
        at com.sun.tools.javac.comp.Lower.visitSwitch(Lower.java:3357)
        at com.sun.tools.javac.tree.JCTree$JCSwitch.accept(JCTree.java:959)
        at com.sun.tools.javac.tree.TreeTranslator.translate(TreeTranslator.java:58)
        at com.sun.tools.javac.comp.Lower.translate(Lower.java:2160)
        at com.sun.tools.javac.tree.TreeTranslator.translate(TreeTranslator.java:70)
        at com.sun.tools.javac.tree.TreeTranslator.visitBlock(TreeTranslator.java:160)
        at com.sun.tools.javac.comp.Lower.visitBlock(Lower.java:3311)
        at com.sun.tools.javac.tree.JCTree$JCBlock.accept(JCTree.java:781)
        at com.sun.tools.javac.tree.TreeTranslator.translate(TreeTranslator.java:58)
        at com.sun.tools.javac.comp.Lower.translate(Lower.java:2160)
        at com.sun.tools.javac.tree.TreeTranslator.visitMethodDef(TreeTranslator.java:144)
        at com.sun.tools.javac.comp.Lower.visitMethodDefInternal(Lower.java:2619)
        at com.sun.tools.javac.comp.Lower.visitMethodDef(Lower.java:2538)
        at com.sun.tools.javac.tree.JCTree$JCMethodDecl.accept(JCTree.java:669)
        at com.sun.tools.javac.tree.TreeTranslator.translate(TreeTranslator.java:58)
        at com.sun.tools.javac.comp.Lower.translate(Lower.java:2160)
        at com.sun.tools.javac.comp.Lower.visitClassDef(Lower.java:2283)
        at com.sun.tools.javac.tree.JCTree$JCClassDecl.accept(JCTree.java:591)
        at com.sun.tools.javac.tree.TreeTranslator.translate(TreeTranslator.java:58)
        at com.sun.tools.javac.comp.Lower.translate(Lower.java:2160)
        at com.sun.tools.javac.comp.Lower.translate(Lower.java:2180)
        at com.sun.tools.javac.comp.Lower.translateTopLevelClass(Lower.java:3650)
        at com.sun.tools.javac.main.JavaCompiler.desugar(JavaCompiler.java:1393)
        at com.sun.tools.javac.main.JavaCompiler.desugar(JavaCompiler.java:1271)
        at com.sun.tools.javac.main.JavaCompiler.compile2(JavaCompiler.java:870)
        at com.sun.tools.javac.main.JavaCompiler.compile(JavaCompiler.java:829)
        at com.sun.tools.javac.main.Main.compile(Main.java:417)
        at com.sun.tools.javac.main.Main.compile(Main.java:331)
        at com.sun.tools.javac.main.Main.compile(Main.java:322)
        at com.sun.tools.javac.Main.compile(Main.java:76)
        at com.sun.tools.javac.Main.main(Main.java:61)
</code></pre><p>Leaving out the opening or closing parenthesis does give a valid compilation error, indicating that parenthesis is valid with string literals in a constant expression.</p>
<p>The build I am using is release candidate and will most likely ship with this bug:</p>
<pre tabindex="0"><code>C:\&gt;java -version
java version &#34;1.7.0&#34;
Java(TM) SE Runtime Environment (build 1.7.0-b147)
Java HotSpot(TM) Client VM (build 21.0-b17, mixed mode, sharing)
</code></pre><p>I have not tried this on a system other than my Windows 7 laptop, but this bug does not seem to be platform specific. In any case, here is some detail about my system:</p>
<pre tabindex="0"><code>NUMBER_OF_PROCESSORS=2
OS=Windows_NT
PROCESSOR_ARCHITECTURE=AMD64
PROCESSOR_IDENTIFIER=Intel64 Family 6 Model 23 Stepping 6, GenuineIntel
PROCESSOR_LEVEL=6
PROCESSOR_REVISION=1706
ProgramData=C:\ProgramData
ProgramFiles=C:\Program Files
ProgramFiles(x86)=C:\Program Files (x86)
ProgramW6432=C:\Program Files
SESSIONNAME=Console
SystemDrive=C:
SystemRoot=C:\Windows
</code></pre><p>The bug id is <a href="http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=7071246">7071246</a>, but is not visible to the public yet. In an email, Oracle says this will be visible only after it is reviewed <em>and</em> does not pose a security concern.</p>
<p>Though using parenthesis in case labels is very uncommon, if one does use it in the form explained above, it is impossible to tell from the error message what or where the issue is. An issue if you are compiling a code base with hundreds or thousands of java classes.</p>
<p>[Update = &ldquo;the bug is now posted on the java bug database in the public domain]&rdquo;</p>

			</div>
		</article>
	</main>
<aside>
	<div>
		<div>
			<h3>LATEST POSTS</h3>
		</div>
		<div>
			<ul>
				
				<li><a href="/blog/2023/02/25/reflections-on-a-roadshow-event/">Reflections on a Roadshow Event</a></li>
				
				<li><a href="/blog/2023/01/13/incident-management-101-communicate-solve-and-analyze/">Incident Management 101: Communicate, Solve, and Analyze</a></li>
				
				<li><a href="/blog/2023/01/10/programming-by-hand-will-remain-essential/">Programming by Hand Will Remain Essential</a></li>
				
				<li><a href="/blog/2023/01/09/the-rise-of-ai-assisted-coding-and-writing/">The Rise of AI-Assisted Coding and Writing</a></li>
				
				<li><a href="/blog/2022/11/17/learning-a-language/">Learning a Language</a></li>
				
			</ul>
		</div>
	</div>
</aside>


	<footer>
	<p>&copy; 2023 <a href="https://www.linkedin.com/in/tapankarecha/"><b>Tapan Karecha</b></a>
	</p>
</footer>

</body>
</html>
